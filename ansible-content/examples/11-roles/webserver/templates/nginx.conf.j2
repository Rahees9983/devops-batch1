# Nginx Configuration
# Managed by Ansible - Do not edit manually

user {{ webserver_user }};
worker_processes {{ webserver_worker_processes }};
error_log {{ webserver_log_dir }}/error.log warn;
pid /run/nginx.pid;

events {
    worker_connections {{ webserver_worker_connections }};
    use epoll;
    multi_accept on;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for"';

    access_log {{ webserver_log_dir }}/access.log main;

    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout {{ webserver_keepalive_timeout }};
    types_hash_max_size 2048;

{% if webserver_hide_version %}
    server_tokens off;
{% endif %}

    client_max_body_size {{ webserver_client_max_body_size }};

{% if webserver_gzip_enabled %}
    gzip on;
    gzip_vary on;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types {{ webserver_gzip_types | join(' ') }};
{% endif %}

{% if webserver_ssl_enabled %}
    ssl_protocols {{ webserver_ssl_protocols }};
    ssl_ciphers {{ webserver_ssl_ciphers }};
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 1d;
{% endif %}

{% if webserver_security_headers %}
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
{% endif %}

    include {{ webserver_config_dir }}/conf.d/*.conf;
    include {{ webserver_config_dir }}/sites-enabled/*.conf;
}

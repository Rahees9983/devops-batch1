# Application Configuration File
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Host: {{ inventory_hostname }}
# DO NOT EDIT MANUALLY

application:
  name: {{ app_name }}
  version: {{ app_version }}
  environment: {{ environment | default('production') }}
{% if debug_mode | default(false) %}
  debug: true
{% else %}
  debug: false
{% endif %}

server:
  host: {{ app_host | default('0.0.0.0') }}
  port: {{ app_port | default(8080) }}
  workers: {{ app_workers | default(ansible_processor_vcpus | default(2)) }}
  timeout: {{ app_timeout | default(30) }}

database:
  engine: {{ database.engine | default('postgresql') }}
  host: {{ database.host }}
  port: {{ database.port }}
  name: {{ database.name }}
  user: {{ database.user }}
  # Password managed separately via environment variable
  pool:
    size: {{ database.pool_size | default(5) }}
    max_overflow: {{ database.max_overflow | default(10) }}
    timeout: {{ database.timeout | default(30) }}

{% if redis is defined %}
redis:
  host: {{ redis.host }}
  port: {{ redis.port | default(6379) }}
{% if redis.password is defined %}
  password: "{{ redis.password }}"
{% endif %}
  db: {{ redis.db | default(0) }}
{% endif %}

logging:
  level: {{ logging.level | default('INFO') | upper }}
  format: {{ logging.format | default('json') }}
  handlers:
{% for handler in logging.handlers | default(['console']) %}
    - {{ handler }}
{% endfor %}
{% if logging.path is defined %}
  file:
    path: {{ logging.path }}/app.log
    max_size: {{ logging.max_size | default('100M') }}
    backup_count: {{ logging.backup_count | default(5) }}
{% endif %}

features:
{% for feature, enabled in features.items() | default([]) %}
  {{ feature }}: {{ enabled | lower }}
{% endfor %}

{% if api_keys is defined %}
api_keys:
{% for key in api_keys %}
  - name: {{ key.name }}
    value: "{{ key.value }}"
    permissions: {{ key.permissions | default(['read']) | to_json }}
{% endfor %}
{% endif %}

{% if services is defined %}
external_services:
{% for service_name, service_config in services.items() %}
  {{ service_name }}:
    url: {{ service_config.url }}
    timeout: {{ service_config.timeout | default(30) }}
{% if service_config.api_key is defined %}
    api_key: "{{ service_config.api_key }}"
{% endif %}
{% endfor %}
{% endif %}

# Security settings
security:
  cors:
    enabled: {{ cors_enabled | default(true) | lower }}
{% if cors_origins is defined %}
    allowed_origins:
{% for origin in cors_origins %}
      - {{ origin }}
{% endfor %}
{% else %}
    allowed_origins:
      - "*"
{% endif %}
  rate_limiting:
    enabled: {{ rate_limiting_enabled | default(true) | lower }}
    requests_per_minute: {{ rate_limit_rpm | default(60) }}
  headers:
    x_frame_options: {{ x_frame_options | default('SAMEORIGIN') }}
    content_security_policy: "{{ csp_policy | default('default-src self') }}"

# Health check endpoint
health:
  enabled: true
  path: /health
  include_details: {{ health_check_details | default(false) | lower }}

# Metadata
metadata:
  generated_at: {{ ansible_date_time.iso8601 }}
  generated_by: Ansible
  ansible_host: {{ inventory_hostname }}
{% if ansible_fqdn is defined %}
  fqdn: {{ ansible_fqdn }}
{% endif %}
  ansible_version: {{ ansible_version.full }}
